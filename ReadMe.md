# æ•°æ™ºçº¢éŸµç½‘

ä¸€ä¸ªèåˆäº†æ–‡åŒ–å±•ç¤ºã€å­¦ä¹ ä¸ AI åˆ›ä½œçš„äº¤äº’å¼çº¢æ­Œæ–‡åŒ–å¹³å°ï¼Œæ”¯æŒæœ¬åœ°å¿«é€Ÿéƒ¨ç½²å’Œå¼€å‘ã€‚

## ğŸ“Œ é¡¹ç›®åç§°

**æ•°æ™ºçº¢éŸµç½‘** - æ™ºèƒ½çº¢æ­Œæ–‡åŒ–å­¦ä¹ ä¸åˆ›ä½œå¹³å°

## ğŸ’» è¿è¡Œç¯å¢ƒ

### å¿…éœ€ç¯å¢ƒ

- **Python 3.8+** - ä¸»è¦å¼€å‘è¯­è¨€
- **SQLite 3** - æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

### å¯é€‰ç¯å¢ƒ

- **Node.js 16+** - ç”¨äºå‰ç«¯å¼€å‘å·¥å…·
- **Docker** - ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²
- **Nginx** - ç”¨äºç”Ÿäº§ç¯å¢ƒåå‘ä»£ç†

### ç³»ç»Ÿè¦æ±‚

- **å†…å­˜**: 2GB+
- **ç£ç›˜ç©ºé—´**: 500MB+
- **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows

## ğŸ“¦ ä¾èµ–åº“åŠå®‰è£…å‘½ä»¤

### å®‰è£…ä¾èµ–

```bash
# æ–¹å¼ä¸€ï¼šä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt

# æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…æ ¸å¿ƒä¾èµ–
pip install Flask==2.3.2
pip install Flask-CORS==4.0.0
pip install Flask-Login==0.6.3
pip install Flask-SQLAlchemy==3.0.5
pip install python-dotenv==1.0.0
pip install SQLAlchemy==2.0.21
pip install requests==2.31.0
pip install pytz
pip install gunicorn
pip install Werkzeug==2.3.7
```

### ä¾èµ–è¯´æ˜

| ä¾èµ–åº“           | ç‰ˆæœ¬   | ç”¨é€”             |
| ---------------- | ------ | ---------------- |
| Flask            | 2.3.2  | Web æ¡†æ¶         |
| Flask-CORS       | 4.0.0  | è·¨åŸŸèµ„æºå…±äº«     |
| Flask-Login      | 0.6.3  | ç”¨æˆ·è®¤è¯ç®¡ç†     |
| Flask-SQLAlchemy | 3.0.5  | æ•°æ®åº“ ORM       |
| SQLAlchemy       | 2.0.21 | SQL å·¥å…·åŒ…       |
| python-dotenv    | 1.0.0  | ç¯å¢ƒå˜é‡ç®¡ç†     |
| requests         | 2.31.0 | HTTP è¯·æ±‚åº“      |
| pytz             | -      | æ—¶åŒºå¤„ç†         |
| gunicorn         | -      | WSGI HTTP æœåŠ¡å™¨ |
| Werkzeug         | 2.3.7  | WSGI å·¥å…·åº“      |

## ğŸš€ è¯¦ç»†è¿è¡Œæ­¥éª¤

### æ­¥éª¤ä¸€ï¼šè·å–é¡¹ç›®ä»£ç 

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœæ‚¨æœ‰ Git ä»“åº“ï¼‰
git clone <your-repo-url> redsong_system
cd redsong_system

# æˆ–è€…ç›´æ¥ä¸‹è½½é¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥ç›®å½•
cd redsong_system
```

### æ­¥éª¤äºŒï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

**Linux/macOS:**

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# éªŒè¯è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼ˆæç¤ºç¬¦å‰ä¼šæœ‰ (.venv) æ ‡è®°ï¼‰
which python  # åº”è¯¥æ˜¾ç¤º .venv/bin/python
```

**Windows:**

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\activate

# æˆ–è€…ä½¿ç”¨ PowerShell
.venv\Scripts\Activate.ps1

# éªŒè¯è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
where python  # åº”è¯¥æ˜¾ç¤º .venv\Scripts\python.exe
```

### æ­¥éª¤ä¸‰ï¼šå®‰è£…ä¾èµ–

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»åï¼Œå®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# ç­‰å¾…å®‰è£…å®Œæˆï¼ŒéªŒè¯å®‰è£…
pip list  # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
```

### æ­¥éª¤å››ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# 1. åˆ›å»º .env æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰ .env.exampleï¼Œè¯·æ‰‹åŠ¨åˆ›å»ºï¼‰
touch .env

# 2. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹é…ç½®
nano .env  # Linux/macOS
# æˆ–ä½¿ç”¨è®°äº‹æœ¬ã€VS Code ç­‰ç¼–è¾‘å™¨æ‰“å¼€ .env æ–‡ä»¶
```

**åœ¨ .env æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š**

```env
# Flask é…ç½®
FLASK_DEBUG=True
FLASK_ENV=development
SECRET_KEY=jf83h_sdf98f3h2983hf9834hf9834h
HOST=0.0.0.0
PORT=5000

# æ•°æ®åº“é…ç½®
DATABASE_URL=sqlite:///project.db

# API å¯†é’¥é…ç½®ï¼ˆå¿…éœ€ï¼‰
OPENROUTER_API_KEY=your_openrouter_api_key_here
KIE_API_KEY=your_kie_api_key_here

# Ngrok é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºå¤–ç½‘è®¿é—®ï¼‰
NGROK_DOMAIN=your-ngrok-domain
```

**è·å– API å¯†é’¥çš„æ–¹æ³•ï¼š**

1. **OpenRouter API Key**: è®¿é—® https://openrouter.ai/ æ³¨å†Œå¹¶è·å–
2. **Kie API Key**: è®¿é—® https://kie.ai/ æ³¨å†Œå¹¶è·å–

### æ­¥éª¤äº”ï¼šå¯åŠ¨åº”ç”¨

**å¼€å‘æ¨¡å¼å¯åŠ¨ï¼š**

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
source .venv/bin/activate  # Linux/macOS
# æˆ– .venv\Scripts\activate  # Windows

# å¯åŠ¨åº”ç”¨
python app.py

# çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š
#  * Running on http://0.0.0.0:5000
#  * Restarting with stat
```

**ä½¿ç”¨ Gunicorn å¯åŠ¨ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰ï¼š**

```bash
# å®‰è£… gunicornï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
pip install gunicorn

# å¯åŠ¨åº”ç”¨
gunicorn --workers 3 --bind 0.0.0.0:5000 app:app
```

### æ­¥éª¤å…­ï¼šè®¿é—®åº”ç”¨

1. æ‰“å¼€æµè§ˆå™¨
2. åœ¨åœ°å€æ è¾“å…¥ï¼š`http://localhost:5000`
3. æ‚¨å°†çœ‹åˆ°æ•°æ™ºçº¢éŸµç½‘çš„ä¸»é¡µ

**ä¸»è¦åŠŸèƒ½é¡µé¢ï¼š**

- ä¸»é¡µï¼š`http://localhost:5000/`
- å¬Â·å±±æ²³ï¼ˆçº¢æ­Œï¼‰ï¼š`http://localhost:5000/circle`
- é—®Â·å¤ä»Šï¼ˆå¯¹è¯ï¼‰ï¼š`http://localhost:5000/making`
- é˜…Â·å³¥åµ˜ï¼ˆè§†é¢‘ï¼‰ï¼š`http://localhost:5000/plaza`
- è°±Â·åç« ï¼ˆåˆ›ä½œï¼‰ï¼š`http://localhost:5000/creation`
- æˆ‘çš„æ”¶è—ï¼š`http://localhost:5000/favorites`

### æ­¥éª¤ä¸ƒï¼šé¦–æ¬¡ä½¿ç”¨æŒ‡å—

1. **æ³¨å†Œè´¦å·**

   - ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„"æ³¨å†Œ"æŒ‰é’®
   - è¾“å…¥ç”¨æˆ·åï¼ˆä¸è¶…è¿‡ 15 ä¸ªå­—ç¬¦ï¼‰
   - è¾“å…¥å¯†ç å¹¶ç¡®è®¤
   - ç‚¹å‡»"æ³¨å†Œ"å®Œæˆ

2. **ç™»å½•ç³»ç»Ÿ**

   - ä½¿ç”¨æ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•
   - ç™»å½•åå¯ä½¿ç”¨æ”¶è—ã€åˆ›ä½œç­‰é«˜çº§åŠŸèƒ½

3. **ä½“éªŒä¸»è¦åŠŸèƒ½**
   - **çº¢æ­Œæ¬£èµ**ï¼šåœ¨"å¬Â·å±±æ²³"ä¸­æœç´¢å’Œæ’­æ”¾çº¢æ­Œ
   - **AI å¯¹è¯**ï¼šåœ¨"é—®Â·å¤ä»Š"ä¸­ä¸"çº¢å°éŸµ"AI åŠ©æ‰‹èŠå¤©
   - **éŸ³ä¹åˆ›ä½œ**ï¼šåœ¨"è°±Â·åç« "ä¸­åˆ›ä½œçº¢æ­Œæ­Œè¯å’ŒéŸ³ä¹
   - **æˆå°±ç³»ç»Ÿ**ï¼šé€šè¿‡ç­”é¢˜ã€åˆ›ä½œç­‰è§£é”æˆå°±å¾½ç« 

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python app.py

# åœæ­¢æœåŠ¡
# åœ¨ç»ˆç«¯ä¸­æŒ‰ Ctrl + C
```

### ç”Ÿäº§æ¨¡å¼

```bash
# ä½¿ç”¨ Gunicorn å¯åŠ¨
gunicorn --workers 3 --bind 0.0.0.0:5000 app:app

# åå°è¿è¡Œï¼ˆLinuxï¼‰
nohup gunicorn --workers 3 --bind 0.0.0.0:5000 app:app > app.log 2>&1 &
```

### æ•°æ®åº“ç®¡ç†

```bash
# é‡ç½®æ•°æ®åº“ï¼ˆåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
rm project.db
python app.py  # é‡æ–°å¯åŠ¨ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“

# æ•°æ®åº“æ–‡ä»¶ä½ç½®
# Linux/macOS: é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ project.db
# Windows: é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ project.db
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å¦‚æœä½¿ç”¨ nohup åå°è¿è¡Œ
tail -f app.log

# å®æ—¶æŸ¥çœ‹æ—¥å¿—æœ€å 100 è¡Œ
tail -100f app.log
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
redsong_system/
â”œâ”€â”€ app.py                 # ä¸»åº”ç”¨æ–‡ä»¶ï¼ˆè·¯ç”±å’Œä¸šåŠ¡é€»è¾‘ï¼‰
â”œâ”€â”€ database.py            # æ•°æ®åº“æ¨¡å‹å’Œåˆå§‹åŒ–
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶ï¼ˆå¸¸é‡ç®¡ç†ï¼‰
â”œâ”€â”€ requirements.txt       # Python ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆéœ€æ‰‹åŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ README.md              # æœ¬æ–‡æ¡£
â”œâ”€â”€ deploy.sh              # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ start.sh               # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ Dockerfile             # Docker å®¹å™¨é…ç½®
â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent_service.py   # AI å¯¹è¯æœåŠ¡
â”‚   â””â”€â”€ llm_service.py     # LLM API è°ƒç”¨æœåŠ¡
â”œâ”€â”€ static/                # é™æ€èµ„æº
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ css/          # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ js/           # JavaScript æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ images/           # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ fonts/            # å­—ä½“æ–‡ä»¶
â”‚   â”œâ”€â”€ music/            # éŸ³ä¹æ–‡ä»¶
â”‚   â””â”€â”€ videos/           # è§†é¢‘æ–‡ä»¶
â””â”€â”€ templates/             # HTML æ¨¡æ¿
    â”œâ”€â”€ index.html        # ä¸»é¡µ
    â”œâ”€â”€ circle.html       # çº¢æ­Œé¡µé¢
    â”œâ”€â”€ making.html       # å¯¹è¯é¡µé¢
    â”œâ”€â”€ plaza.html        # è§†é¢‘é¡µé¢
    â”œâ”€â”€ creation.html     # åˆ›ä½œé¡µé¢
    â”œâ”€â”€ favorites.html    # æ”¶è—é¡µé¢
    â””â”€â”€ ...
```

## ğŸ”§ API æ¥å£æ–‡æ¡£

### ç”¨æˆ·è®¤è¯

- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/status` - è·å–è®¤è¯çŠ¶æ€
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### çº¢æ­ŒåŠŸèƒ½

- `GET /api/songs/search?q=å…³é”®è¯` - æœç´¢çº¢æ­Œ
- `GET /api/songs/by_region/åœ°åŒº` - æŒ‰åœ°åŒºè·å–çº¢æ­Œ
- `POST /api/song/toggle_favorite/{id}` - åˆ‡æ¢æ”¶è—çŠ¶æ€
- `GET /api/songs/favorites` - è·å–æ”¶è—åˆ—è¡¨

### AI åŠŸèƒ½

- `POST /api/agent/chat` - AI å¯¹è¯ï¼ˆçº¢å°éŸµï¼‰
- `POST /api/create/lyrics` - AI ä½œè¯
- `POST /api/create/song/start` - å¼€å§‹ AI ä½œæ›²
- `GET /api/create/song/status/{task_id}` - æŸ¥è¯¢ä½œæ›²çŠ¶æ€

### ç­”é¢˜å’Œæˆå°±

- `GET /api/quiz/questions` - è·å–ç­”é¢˜é¢˜ç›®
- `POST /api/quiz/submit` - æäº¤ç­”æ¡ˆ
- `GET /api/achievements` - è·å–æˆå°±åˆ—è¡¨

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šè™šæ‹Ÿç¯å¢ƒæ¿€æ´»å¤±è´¥

```bash
# é”™è¯¯æç¤ºï¼šcommand not found: .venv/bin/activate
# è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿é¡¹ç›®ç›®å½•ä¸‹æœ‰ .venv æ–‡ä»¶å¤¹
ls -la .venv  # æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒæ˜¯å¦å­˜åœ¨

# å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°åˆ›å»º
python3 -m venv .venv
```

### é—®é¢˜ 2ï¼šä¾èµ–å®‰è£…å¤±è´¥

```bash
# é”™è¯¯æç¤ºï¼šPermission denied
# è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ --user å‚æ•°æˆ–æ£€æŸ¥æƒé™
pip install --user -r requirements.txt

# æˆ–è€…ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### é—®é¢˜ 3ï¼šç«¯å£è¢«å ç”¨

```bash
# é”™è¯¯æç¤ºï¼šAddress already in use
# è§£å†³æ–¹æ¡ˆä¸€ï¼šä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ PORT
PORT=8000  # æ”¹ä¸ºå…¶ä»–ç«¯å£

# è§£å†³æ–¹æ¡ˆäºŒï¼šåœæ­¢å ç”¨ç«¯å£çš„ç¨‹åº
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5000  # Linux/macOS
netstat -ano | findstr :5000  # Windows

# æ€æ­»è¿›ç¨‹
kill -9 <PID>  # Linux/macOS
taskkill /PID <PID> /F  # Windows
```

### é—®é¢˜ 4ï¼šAPI å¯†é’¥é”™è¯¯

```bash
# é”™è¯¯æç¤ºï¼šAPI Key not configured or invalid
# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ API å¯†é’¥é…ç½®
cat .env  # æŸ¥çœ‹ API å¯†é’¥æ˜¯å¦æ­£ç¡®å¡«å†™

# ç¡®ä¿ API å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆæ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–å¼•å·ï¼‰
```

### é—®é¢˜ 5ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# é”™è¯¯æç¤ºï¼šdatabase is locked
# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la project.db  # æŸ¥çœ‹æ–‡ä»¶æƒé™
chmod 664 project.db  # ä¿®æ”¹æƒé™ï¼ˆLinux/macOSï¼‰

# æˆ–è€…åˆ é™¤æ•°æ®åº“æ–‡ä»¶é‡æ–°åˆ›å»º
rm project.db
python app.py  # é‡æ–°å¯åŠ¨ä¼šè‡ªåŠ¨åˆ›å»º
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. æ£€æŸ¥æœ¬ README çš„"æ•…éšœæ’é™¤"éƒ¨åˆ†
2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—è¾“å‡º
3. ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
4. ç¡®è®¤è™šæ‹Ÿç¯å¢ƒå·²æ­£ç¡®æ¿€æ´»
5. éªŒè¯æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä»…ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ã€‚è¯·ç¡®ä¿éµå®ˆç›¸å…³ API æœåŠ¡çš„ä½¿ç”¨æ¡æ¬¾ã€‚
